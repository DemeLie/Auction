{% extends "layout.html" %}

{% block body %}
<div class="container">
    <div class="row">
        <div class="col-lg-6 d-flex align-items-start">
            <img src="{{ listing.images.url }}" alt="{{ listing.name }}" class="img-fluid" style="max-width: 500px; margin-right: 10px;">
        </div>
        <div class="col-lg-6">
            <h1>{{ listing.name }}
                {% if user.is_authenticated and listing.active %}
                    {% if in_watchlist %}
                        <a class="btn btn-outline-info btn-sm" href="{% url 'add_to_watchlist' listing.id %}">Unfollow</a>
                    {% else %}
                        <a class="btn btn-outline-info btn-sm" href="{% url 'add_to_watchlist' listing.id %}">Follow</a>
                    {% endif %}
                {% endif %}
            </h1>
            <p class="lead">{{ listing.description }}</p>
            <p class="lead">Current Bid: ${{ listing.current_bid }}</p>
        {% if user.is_authenticated and listing.active%}
            <form action="{% url 'place_bid' listing.id %}" method="post">
                {% csrf_token %}
                <div class="form-group">
                    <label for="bid">Place Your Bid:</label>
                    <input type="text" name="bid" id="bid" class="form-control" placeholder="Enter your bid amount" size="20">
                </div>
                <button type="submit" class="btn btn-outline-success">Place Bid</button>
                {% if listing.usr == user %}
                    <a class="btn btn btn-outline-danger" href={% url 'close_listing' listing.id %}>Close listing</a>
                {% endif %}
            </form>
        {% elif not listing.active %}
            <div class="p-3 mb-2 alert alert-danger text-dark text-center" style=" padding: 20px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); " role="alert">
                Listing is closed
                <a class="alert-link " href={% url 'delete_listing' listing.id %}>You can delete it</a>
            </div>
        {% else %}
            <div class="p-3 mb-2 bg-dark text-light text-center " style=" padding: 20px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); " role="alert">
                Login to place a bet
            </div>
        {% endif %}
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-lg-6" style="padding-bottom: 20px">
            <div class="card">
                <div class="card-header">
                        <h4>Details</h4>
                        <ul>
                            <li>Listed by: <strong>{{ listing.usr }}</strong></li>
                            <li>Category: <strong>{{ listing.category }}</strong></li>
                        </ul>
                    </div>
            </div>
        </div>
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Comments</h4>
                </div>
                <div class="card-body">
                    {% for comment in comments %}
                        <div class="comment">
                            <strong>{{ comment.user }}</strong>: {{ comment.text }}
                        </div>
                    {% empty %}
                        <p>No comments yet.</p>
                    {% endfor %}
                    {% if user.is_authenticated %}
                        <div class="">
                    <form method="post" action="{% url 'add_comment' listing.id %}">
                            {% csrf_token %}
                            <div class="form-group">
                                <textarea id="text" name="text" placeholder="Add Your Comment" class="form-control"></textarea>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-dark btn-sm">Add Comment</button>
                            </div>
                        </form>
                        </div>
                {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
